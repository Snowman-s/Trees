# 文法

## 概要

このプログラムは「ブロック」と呼ばれるものの組み合わせとして記述されます。  
ブロックを線（「ライン」）によって接続し、構文木を直接構成します。

```《3 × 4を表示するプログラム》
        ┌─────┐
        │print│
        └───┬─┘
        ┌───┴─┐
    ┌───┤  *  ├──┐
    │   └─────┘  │
┌───┴─┐      ┌───┴─┐
│  3  │      │  4  │
└─────┘      └─────┘ 
```

各ブロックは、たかだか１つの出力 と、0～任意の個数の入力 を持ちます。  
**ブロック参照を送るためのラインはブロックの上辺から出る必要があります。**  
**ブロック参照を受け取るためのラインはブロックの左辺・右辺・下辺から出る必要があります。（詳細は後述）**

上辺から出るラインが無いブロックはただ１つである必要があり、プログラムの開始地点となります。  

## 詳細なブロックの記法

ブロックは全て対応するただ１つのプロシージャを持ち、「実行する」操作を持ちます。  
プロシージャは既に定義済みの処理の塊で、処理を可変にするための引数を...ああ、だから他の言語で言う関数やメソッドにあたります。ただし、引数はブロックです。

ブロックは、２通りの記法で記述できます。

### 詳細記法
```  
           │     
      ┌────┴───┐
      │ <name> │
      ├────────┤
      │        ├───...
      ├────────┤
 ...──┤        │
      ├────────┤
      │  ...   │
      ├────────┤
      │        ├───...
      └────────┘
```

詳細記法では、最初にブロックが使用するプロシージャ名を記述し、それよりも下にプロシージャに渡す引数ブロックを受け取るための領域を連続させます。  
**プロシージャが受け取る引数ブロックを伝えるラインは、その引数を受け取る領域の左右どちらかからただ一つ伸ばす必要があります。（向きは関係なし、が下から伸ばすのは不可）**

### 簡易記法
```
           │     
      ┌────┴───┐
 ...──┤        ├───... 
 ...──┤ <name> ├───...
 ...──┤        ├───...
      └┬┬┬┬┬┬┬┬┘
       ││││││││
```

簡易記法では、引数ブロックを受け取るための領域を省略します。  
**引数は、左上から反時計回りの順に結び付けられたものと見做されます。**

## リテラル

リテラルとは、ブロックが「実行」されたときに必ず得られるただ１つのデータです。  
「整数」「文字列」「ボイド」があります。

## 変数

「変数」はリテラルを、1つずつ文字列と結び付け保持する機構です。  
変数名はグローバルかつプロシージャ名と同じ名前空間を共有します。

変数の値は、プロシージャと同じ書式でアクセスできます。引数は無く、実行時の返り値は変数の値です。

```
         │   
  ┌──────┴─────┐
  │ <var_name> │
  └────────────┘
```

## 定義済みプロシージャ

### 整数

名前が全て数字の連続であるプロシージャは、整数を返す定義済みプロシージャとなります。

```
     │   
  ┌──┴──┐
  │ 123 │
  └─────┘
```

### 文字列

名前が`"` で開始するプロシージャは、文字列を返す定義済みプロシージャとなります。

```
     │   
  ┌──┴──┐
  │ "AA │
  └─────┘
```

### ボイド

名前が空文字であるプロシージャは、ボイドを返す定義済みプロシージャとなります。  
空処理である場合、代わりに使用できます。

```
     │   
  ┌──┴──┐
  │     │
  └─────┘
```

### 四則演算

名前が「+」「-」「*」「/」 であるプロシージャは、四則演算をするプロシージャとなります。

```  
           │     
      ┌────┴───┐
      │   +    │
      ├────────┤
      │        ├───...
      ├────────┤
 ...──┤        │
      └────────┘
```

### その他

その他のプロシージャとして、printなどがあります。詳しくは一覧を参照してください。

### 一覧

> 下表では、特に明記しない限り「aブロックを実行した結果」を単にaと呼ぶこととします。

> 本来引数ブロックの返り値の型検査は行われないものの、補助として型を記述しています。実行に際してリテラルの型が異なった場合、エラーとなります。

#### リテラルプロシージャ

|       名前        |  引数  |          説明          |               返り値                |
| :---------------: | :----: | :--------------------: | :---------------------------------: |
| 正規表現 `[0-9]+` | <無し> |  記述された整数を返す  |           記述された整数            |
|  正規表現 `".*`   | <無し> | 記述された文字列を返す | 記述された文字列（先頭の`"`を除く） |
|        ` `        | <無し> |      ボイドを返す      |               ボイド                |

#### 四則演算

| 名前  |       引数       | 説明  |                  返り値                  |
| :---: | :--------------: | :---: | :--------------------------------------: |
|  `+`  | (a: Int, b: Int) | 加算  |           a, b の返り値の加算            |
|  `-`  | (a: Int, b: Int) | 減算  |        a, bの返り値の減算 (a - b)        |
|  `*`  | (a: Int, b: Int) | 乗算  |            a, bの返り値の乗算            |
|  `/`  | (a: Int, b: Int) |  商   |   a, bの返り値を除算し、その商 (a / b)   |
|  `%`  | (a: Int, b: Int) | 余り  | a, bの返り値を除算し、その余り (a mod b) |

#### 変数関連

|   名前   |          引数           |             説明              |  返り値  |
| :------: | :---------------------: | :---------------------------: | :------: |
| <変数名> |         <無し>          | 変数の値を返す(getの糖衣構文) | 変数の値 |
|   get    |       var:String        |       var変数の値を返す       | 変数の値 |
|   set    | (var:String, from: any) |   from を var変数に代入する   | 変数の値 |

#### 定義済み処理

|  名前   | 引数  |      説明       | 返り値 |
| :-----: | :---: | :-------------: | :----: |
| `print` | a:any | aを標準出力する | ボイド |

#### コントロールフロー

| 名前  |                 引数                  |                                            説明                                             |           返り値           |
| :---: | :-----------------------------------: | :-----------------------------------------------------------------------------------------: | :------------------------: |
| `seq` |        <可変長: any, any, ...>        |                           引数のブロックを先頭から順番に実行する                            |           ボイド           |
| `for` | (times: Int, var: String, child: any) | times 回 childブロックの実行を行う。回数はvar変数に保存される (var = 0, 1, 2, ..., times-1) |           ボイド           |
| `if0` |   (cond: any, then: any, else:any)    |             cond が0でないならthenブロックを実行し、0ならelseブロックを実行する             | 実行したブロックの実行結果 |
